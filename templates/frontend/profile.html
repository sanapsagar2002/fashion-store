{% extends 'base.html' %}

{% block title %}My Profile - Fashion Store{% endblock %}

{% block content %}
<div class="container py-5">
    <h2 class="mb-4">My Profile</h2>
    
    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h5>Personal Information</h5>
                </div>
                <div class="card-body">
                    <form id="profile-form">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">First Name</label>
                                <input type="text" class="form-control" name="first_name" id="first_name">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Last Name</label>
                                <input type="text" class="form-control" name="last_name" id="last_name">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Email Address</label>
                            <input type="email" class="form-control" name="email" id="email" readonly>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Phone Number</label>
                            <input type="tel" class="form-control" name="phone" id="phone">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Address</label>
                            <textarea class="form-control" name="address" id="address" rows="3"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Update Profile</button>
                    </form>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h5>Account Information</h5>
                </div>
                <div class="card-body">
                    <p><strong>Member since:</strong> <span id="member_since"></span></p>
                    <p><strong>Email verified:</strong> <span id="email_verified"></span></p>
                    <div class="mt-3">
                        <a href="/orders/" class="btn btn-outline-primary w-100 mb-2">View Orders</a>
                        <a href="/cart/" class="btn btn-outline-secondary w-100">View Cart</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    async function loadProfile() {
        if (!authToken) {
            window.location.href = '/login/';
            return;
        }

        try {
            const response = await apiRequest('/api/auth/profile/');
            const user = await response.json();
            
            // Populate form fields
            document.getElementById('first_name').value = user.first_name || '';
            document.getElementById('last_name').value = user.last_name || '';
            document.getElementById('email').value = user.email || '';
            document.getElementById('phone').value = user.phone || '';
            document.getElementById('address').value = user.address || '';
            document.getElementById('member_since').textContent = new Date(user.created_at).toLocaleDateString();
            document.getElementById('email_verified').textContent = user.is_verified ? 'Yes' : 'No';
        } catch (error) {
            console.error('Error loading profile:', error);
            showAlert('Error loading profile', 'danger');
        }
    }

    document.getElementById('profile-form').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const formData = new FormData(this);
        const profileData = {
            first_name: formData.get('first_name'),
            last_name: formData.get('last_name'),
            phone: formData.get('phone'),
            address: formData.get('address')
        };
        
        try {
            const response = await apiRequest('/api/auth/profile/', {
                method: 'PUT',
                body: JSON.stringify(profileData)
            });
            
            if (response.ok) {
                showAlert('Profile updated successfully!', 'success');
            } else {
                const error = await response.json();
                showAlert(error.detail || 'Failed to update profile', 'danger');
            }
        } catch (error) {
            console.error('Profile update error:', error);
            showAlert('Failed to update profile', 'danger');
        }
    });

    // Load profile on page load
    document.addEventListener('DOMContentLoaded', function() {
        loadProfile();
    });
</script>
{% endblock %}
